<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Management</title>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>

    <div class="container">
        <div class="row my-4">
            <div class="col-lg-12">
                <div class="table-responsive">
                    <table class="table table-striped text-center" id="userTable">
                        <thead>
                            <tr class="table-dark">
                                <th>ID</th>
                                <th>Username</th>
                                <th>Followers</th>
                                <th>Following</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="userTableBody">
                            <!-- Dynamic data will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <!-- Add this modal code after your existing HTML -->
<div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title" id="editModalLabel">Edit User</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
              </button>
          </div>
          <div class="modal-body">
              <form id="editUserForm">
                  <div class="form-group">
                      <label for="editUsername">Username</label>
                      <input type="text" class="form-control" id="editUsername" name="username" required>
                  </div>
                  <!-- Add input fields for other user information here (e.g., email, password) -->
                  <input type="hidden" id="editUserId">
              </form>
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
              <button type="submit" class="btn btn-primary" id="saveChangesBtn">Save Changes</button>
          </div>
      </div>
  </div>
</div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
    <!-- Font Awesome for icons -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/all.min.js"></script>
    
    <script>
$(document).ready(function() {
    // Function to fetch user data and populate the table
    function fetchUsers() {
        $.ajax({
            url: '/admin/users', // Your backend endpoint to fetch users
            method: 'GET',
            success: function(users) {
                // Clear existing table rows
                $('#userTableBody').empty();
                // Iterate through each user and append to table
                users.forEach(function(user) {
                    $('#userTableBody').append(`
                        <tr>
                            <td>${user.id}</td>
                            <td>${user.username}</td>
                            <td>${user.followers}</td>
                            <td>${user.following}</td>
                            <td>
                                <button class="btn btn-primary edit-btn" data-id="${user.id}">Edit</button>
                                <button class="btn btn-danger delete-btn" data-id="${user.id}">Delete</button>
                            </td>
                        </tr>
                    `);
                });
            },
            error: function(err) {
                console.error(err);
                alert('Error fetching users');
            }
        });
    }
    
    // Call fetchUsers function when the page loads
    fetchUsers();
    
    // Event listener for editing user data
    $(document).on('click', '.edit-btn', function() {
        const userId = $(this).data('id');
        // Fetch user data by userId and populate modal fields
        $.get(`/admin/users/${userId}`, function(user) {
            $('#editUsername').val(user.username);
            // Populate other input fields as needed
            $('#editUserId').val(userId);
            // Show the modal
            $('#editModal').modal('show');
        });
    });
    
    // Event listener for saving changes in the modal
    $('#saveChangesBtn').click(function() {
        const userId = $('#editUserId').val();
        const username = $('#editUsername').val();
        // Retrieve other input fields as needed
        const userData = { 
            username: username /* add other fields here */ 
        };

        // Call editUserData function to update user data
        editUserData(userId, userData)
            .then(editedUserData => {
                alert('User data updated successfully');
                $('#editModal').modal('hide');
                // Refresh user data in the table
                fetchUsers();
            })
            .catch(error => {
                console.error(error);
                alert('Error updating user data');
            });
    });

    // Delete user
    $(document).on('click', '.delete-btn', function() {
        const userId = $(this).data('id');
        if (confirm('Are you sure you want to delete this user?')) {
            $.ajax({
                url: `/admin/users/${userId}`,
                type: 'DELETE',
                success: function(response) {
                    alert(response);
                    // Remove the row from the table
                    $(`#userTableBody tr[data-id="${userId}"]`).remove();
                },
                error: function(err) {
                    console.error(err);
                    alert('An error occurred while deleting the user.');
                }
            });
        }
    });
});




        
    </script>
</body>

</html>
